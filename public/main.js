var v=Intl.DateTimeFormat(void 0,{dateStyle:"short",timeStyle:"short"}),x={ids:[],todos:{},selected:[]},H={root:document.getElementById("main"),todos:{},fragment:document.createDocumentFragment()},E={colors:[],status:"all",tags:[]},C={},p={templateButtonTag:document.getElementById("template_button-tag"),templateTodotag:document.getElementById("template_todo-tag")},L={add(y,f,U){if(x.ids.push(y),x.todos[y]=f,H.todos[y]=U,localStorage.setItem(`todo.${y}`,JSON.stringify(f)),localStorage.setItem("todo.ids",JSON.stringify(x.ids)),f.tags.length>0)R.add(f.tags);if(E.status!=="completed"){if(E.colors.length>0&&!A.includeColor(f.color))return;if(E.tags.length>0&&(f.tags.length===0||!A.includeTags(f.tags)))return;x.selected.push(y),U.setAttribute("data-display","1")}H.root?.appendChild(U)},editTags(y,f,U){if(f.length===0&&U.length===0)return!1;else if(U.length===0)return R.remove(f),f.length=0,y.setAttribute("data-display","0"),y.replaceChildren(),!0;else if(f.length===0){R.add(U);for(let J=0;J<U.length;J+=1){let K=U[J],P=R.createDOMTodoTag(K);H.fragment.appendChild(P),f.push(K)}return Element.prototype.replaceChildren.apply(y,H.fragment.children),y.setAttribute("data-display","1"),!0}let k=f.length<U.length?f.length:U.length,q=y.children,z=0;while(z<k&&f[z]===U[z])H.fragment.appendChild(q[0]),z+=1;let G=!1;if(!(z===k&&f.length===U.length)){R.add(U,z),R.remove(f,z);let J;for(let K=z;K<U.length;K+=1){let P=U[K];if(K<f.length)J=q[0],R.editDOMTodoTag(J,P);else J=R.createDOMTodoTag(P);H.fragment.appendChild(J),f[K]=P}if(U.length<f.length)f.length=U.length;G=!0}return Element.prototype.replaceChildren.apply(y,H.fragment.children),y.setAttribute("data-display","1"),G},edit(y,f,U,k,q){const z=x.todos[y];if(z===void 0)return;const G=H.todos[y];let J=!1;if(f){J=!0;const K=Date.now();z.date=K,G.header.firstElementChild.textContent=v.format(K);let P=x.ids.indexOf(y),Q=x.ids.length;if(P===-1){console.error("TodosMethods.edit: There is no id in ids.","Something is break");return}if(x.ids.copyWithin(P,P+1,Q),x.ids[Q-1]=y,P=x.selected.indexOf(y),P!==-1)Q=x.selected.length,x.selected.copyWithin(P,P+1,Q),x.selected[Q-1]=y;H.root.appendChild(G)}if(U!==z.text)J=!0,z.text=U,G.main.firstElementChild.textContent=U;if(k!==z.color)J=!0,z.color=k,G.setAttribute("data-color",k);if(q!==void 0){const K=G.footer;let P=L.editTags(K,z.tags,q);if(P)J=P}if(J)localStorage.setItem(`todo.${y}`,JSON.stringify(z))},remove(y){const f=x.ids,U=f.indexOf(y);if(U===-1)return;if(U!==f.length-1)f.copyWithin(U,U+1,f.length);f.pop();const k=H.todos[y];R.remove(x.todos[y].tags),delete x.todos[y],delete H.todos[y],L.removeSelected(y),H.root.removeChild(k),localStorage.removeItem(`todo.${y}`),localStorage.setItem("todo.ids",JSON.stringify(x.ids))},removeSelected(y){const f=x.selected;let U=f.indexOf(y);if(U===-1)return!1;if(U!==f.length-1)f.copyWithin(U,U+1,f.length);f.pop();const k=H.todos[y];if(k!==void 0)k.setAttribute("data-display","0");return!0},toggleCompleted(y){const f=x.todos[y];if(f===void 0)return;f.completed=!f.completed,localStorage.setItem(`todo.${y}`,JSON.stringify(f));const U=H.todos[y];if(U===void 0)throw Error("DOMTodo is undefined when it must not be");if(L.setDOMTodoComplete(U,f.completed),f.completed&&E.status==="active"||!f.completed&&E.status==="completed")L.removeSelected(y)},setDOMTodoComplete(y,f){if(f)y.setAttribute("data-completed","1"),y.buttonToggle.title="mark as no completed";else y.setAttribute("data-completed","0"),y.buttonToggle.title="mark as completed"}},A={clearCompleted(){const y=x.ids;let f=-1;for(let U=0;U<y.length;U+=1){let k=y[U];const q=x.todos[k];if(q.completed){const z=H.todos[k];if(R.remove(q.tags),delete x.todos[k],delete H.todos[k],H.root.removeChild(z),localStorage.removeItem(`todo.${k}`),f===-1)f=U}else if(f!==-1)y[f]=y[U],f+=1}if(f===-1)return;switch(y.length=f,localStorage.setItem("todo.ids",JSON.stringify(y)),E.status){case"active":return;case"completed":{x.selected.length=0;return}default:{const U=x.selected;f=-1;for(let k=0;k<U.length;k+=1){const q=U[k];if(x.todos[q]===void 0){if(f===-1)f=k}else if(f!==-1)U[f]=U[k],f+=1}if(f!==-1)U.length=f}}},completeAll(){let y=!1;for(let f=0;f<x.ids.length;f+=1){let U=x.ids[f],k=x.todos[U];if(!k.completed){y=!0,k.completed=!0,localStorage.setItem(`todo.${U}`,JSON.stringify(k));let q=H.todos[U];if(E.status==="active")q.setAttribute("data-desplay","0");L.setDOMTodoComplete(q,!0)}}if(!y)return;switch(E.status){case"all":return;case"active":x.selected.length=0;break;default:A.selectTodos()}},changeColor(y,f){if(E.colors.length>0){const U=E.colors.indexOf(y);if(f){if(U!==-1)return;E.colors.push(y),A.selectTodos()}else{if(U===-1)return;if(E.colors[U]=E.colors[E.colors.length-1],E.colors.pop(),E.colors.length>0){let k=0;const q=x.selected;for(let z=0;z<q.length;z+=1){let G=q[z],J=x.todos[G];if(y!==J.color)q[k]=q[z],k+=1;else H.todos[G].setAttribute("data-display","0")}q.length=k}else A.selectTodos()}}else if(f){const U=x.selected;let k=0;for(let q=0;q<U.length;q+=1){let z=U[q],G=x.todos[z];if(y===G.color)U[k]=z,k+=1;else H.todos[z].setAttribute("data-display","0")}U.length=k,E.colors.push(y)}},changeStatus(y){if(y===E.status)return;E.status=y,A.selectTodos()},includeColor(y){let f;for(let U=0;U<E.colors.length;U+=1)if(f=E.colors[U],y===f)return!0;return!1},includeTags(y){let f=y.length;if(f<E.tags.length)return!1;let U="",k="";y:for(let q=0;q<E.tags.length;q+=1){k=E.tags[q];for(let z=0;z<f;z+=1)if(U=y[z],U===k){y[z]=y[f-1],y[f-1]=U,f-=1;continue y}return!1}return!0},selectTodos(){const{selected:y,ids:f}=x;if(E.status==="all")for(let q=0;q<f.length;q+=1)y[q]=f[q];else{const q=E.status==="completed";let z=0;for(let G=0;G<f.length;G+=1){let J=f[G];if(x.todos[J].completed===q)y[z]=J,z+=1;else H.todos[J].setAttribute("data-display","0")}if(z<y.length)y.length=z}const U=E.colors;if(U.length>0){let q=0;for(let z=0;z<y.length;z+=1){let G=!0,J=y[z],K=x.todos[J];for(let P=0;P<U.length;P+=1)if(K.color===U[P]){y[q]=J,q+=1,G=!1;break}if(G)H.todos[J].setAttribute("data-display","0")}y.length=q}const k=E.tags;if(k.length>0){let q=0;while(q<k.length&&y.length>0){const z=k[q];let G=0;for(let J=0;J<y.length;J+=1){let K=!0;const P=y[J],Q=x.todos[P].tags;for(let V=0;V<Q.length;V+=1)if(Q[V]===z){y[G]=P,G+=1,K=!1;break}if(K)H.todos[P].setAttribute("data-display","0")}y.length=G,q+=1}}for(let q=0;q<y.length;q+=1){let z=y[q];H.todos[z].setAttribute("data-display","1")}},addTag(y){if(E.tags.length===0||!E.tags.includes(y)){const f=x.selected;let U=0;for(let k=0;k<f.length;k+=1){let q=!0;const z=f[k],G=H.todos[z],J=x.todos[z].tags;for(let K=0;K<J.length;K+=1)if(J[K]===y){f[U]=z,U+=1,G.setAttribute("data-display","1"),q=!1;break}if(q)G.setAttribute("data-display","0")}return f.length=U,E.tags.push(y),!0}return!1},removeTag(y){let f=E.tags.indexOf(y);if(f===-1)return!1;return E.tags.copyWithin(f,f+1,E.tags.length),E.tags.pop(),A.selectTodos(),!0}},R={createDOMButtonTag(y){const f=p.templateButtonTag.content.cloneNode(!0).firstElementChild;return R.editDOMButtonTag(f,y),f},editDOMButtonTag(y,f){y.title=`tag: ${f}`,y.setAttribute("data-value",f),y.textContent=f},createDOMTodoTag(y){const f=p.templateTodotag.content.cloneNode(!0).firstElementChild;return f.title=`tag: ${y}`,f.firstElementChild.textContent=y,f},editDOMTodoTag(y,f){y.title=`tag: ${f}`,y.firstElementChild.textContent=f},add(y,f){if(f===void 0)f=0;let U="";while(f<y.length){if(U=y[f],C[U]!==void 0)C[U]+=1;else C[U]=1;f+=1}},remove(y,f){if(f===void 0)f=0;let U="";while(f<y.length){if(U=y[f],C[U]!==void 0){if(C[U]-=1,C[U]===0)delete C[U]}f+=1}}};var m=function(){let y=Date.now().toString();for(let f=0;f<8;f+=1){const U=w[Math.floor(Math.random()*w.length)],k=Math.floor(Math.random()*y.length);if(k===y.length)y=String.prototype.concat.call(y,U);else if(k===0)y=String.prototype.concat.call(U,y);else y=String.prototype.concat.call(String.prototype.slice.call(y,0,k),U,String.prototype.slice.call(y,k))}return y},I=function(y,f,U,k,q="default",z=!1){const J=_.content.cloneNode(!0).firstElementChild;if(J.id=y,J.setAttribute("data-color",q),z)J.setAttribute("data-completed","1");const{firstElementChild:K,lastElementChild:P}=J,Q=K.children[0],V=K.children[1],X=K.children[2],Y=Q.children[0],Z=Q.children[1],$=Q.children[2];if(Y.textContent=v.format(U),Z.setAttribute("data-id",y),$.setAttribute("data-id",y),V.firstElementChild.textContent=f,J.header=Q,J.main=V,J.footer=X,k.length>0){X.setAttribute("data-display","1");for(let b=0;b<k.length;b+=1){const N=R.createDOMTodoTag(k[b]);X.appendChild(N)}}const W=P.firstElementChild;return W.setAttribute("data-id",y),J.buttonToggle=W,J},u=function(y,f,U){const k=m(),q=Date.now(),z={color:f,completed:!1,date:q,id:k,tags:Array.from(U),text:y},G=I(k,y,q,U,f);L.add(k,z,G)},_=document.getElementById("template_todo"),w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_";var F=function(y,f,U){const k=f.suggested;if(y.length===0){U.tagsSuggested.setAttribute("data-show","0"),U.noTagsSuggested?.setAttribute("data-show","0");return}else if(y.length===1){const q=U.tagsSuggested.children,z=f.tempSuggested;if(y===f.charSuggested)for(let G=0;G<z.length;G+=1)k[G]=G,q[G].setAttribute("data-display","1");else{f.charSuggested=y;let G=0,J=k.length;for(let K in C)if(y===K[0]){let P;if(G<J)P=q[0],R.editDOMButtonTag(P,K),P.setAttribute("data-display","1");else P=R.createDOMButtonTag(K);U.fragment.appendChild(P),k[G]=G,z[G]=K,G+=1}if(G<z.length)k.length=G,z.length=G;Element.prototype.replaceChildren.apply(U.tagsSuggested,U.fragment.children)}}else if(f.input.length<y.length&&k.length>0){const q=U.tagsSuggested.children,z=f.tempSuggested;let G=0;for(let J=0;J<k.length;J+=1){let K=k[J],P=z[K],Q=q[K];if(P.startsWith(y))Q.setAttribute("data-display","1"),k[G]=K,G+=1;else Q.setAttribute("data-display","0")}if(G<k.length)k.length=G}else if(f.tempSuggested.length>0&&y.length<f.input.length){const q=U.tagsSuggested.children,z=f.tempSuggested;let G=0;for(let J=0;J<z.length;J+=1){let K=z[J],P=q[J];if(K.startsWith(y))P.setAttribute("data-display","1"),k[G]=J,G+=1;else P.setAttribute("data-display","0")}if(G<k.length)k.length=G}if(k.length>0)U.tagsSuggested.setAttribute("data-show","1"),U.noTagsSuggested?.setAttribute("data-show","0");else U.tagsSuggested.setAttribute("data-show","0"),U.noTagsSuggested?.setAttribute("data-show","1")};var l={CREATE:"create",CREATE_TITLE:"New Todo",EDIT:"edit",EDIT_TITLE:"Edit Todo",editId:""},O={input:"",selected:[],charSuggested:"",suggested:[],tempSuggested:[]},D="modal_todo",r={root:document.getElementById(D),title:document.getElementById("modal_todo-title"),text:document.getElementById(D).text,sectionDate:document.getElementById("modal_todo-section-date"),changeDate:document.getElementById(D).change_date,color:document.getElementById(D).color,tagsInput:document.getElementById(D).tags_input,tagsAdd:document.getElementById(D).tags_add,tagsSuggested:document.getElementById(D).tags_suggested,sectionSelected:document.getElementById("modal_todo-section-selected"),tagsSelected:document.getElementById(D).tags_selected,buttonComplete:document.getElementById(D).button_complete,fragment:document.createDocumentFragment()},S={createDOMTagSelected(y){return R.createDOMButtonTag(y)},createDOMTagSuggested(y){return R.createDOMButtonTag(y)},closeTodoModal(){r.root.setAttribute("data-display","0"),document.body.style.overflow=""},initTagsEdit(y){if(y.length>0){const f=O.selected,U=r.tagsSelected.children,k=f.length;for(let q=0;q<y.length;q+=1){let z=y[q];if(z!==f[q]){if(q<k){const G=U[0];R.editDOMButtonTag(G,z),r.fragment.appendChild(G)}else{const G=S.createDOMTagSelected(z);r.fragment.appendChild(G)}f[q]=z}else r.fragment.appendChild(U[0])}if(y.length<f.length)f.length=y.length;r.sectionSelected.setAttribute("data-display","1"),Element.prototype.replaceChildren.apply(r.tagsSelected,r.fragment.children)}else O.selected.length=0,r.sectionSelected.setAttribute("data-display","0"),r.tagsSelected.replaceChildren()},openTodoModal(){r.tagsSuggested.setAttribute("data-show","0"),r.tagsInput.value="",r.root.setAttribute("data-display","1"),document.body.style.overflow="hidden",r.text.focus()},removeTag(y){const f=O.selected;let U=f.indexOf(y);if(U!==-1)f.copyWithin(U,U+1,f.length),f.pop();if(f.length===0)r.sectionSelected.setAttribute("data-display","0")},resetTagsSelected(){O.selected.length=0,r.tagsSelected.replaceChildren()},addTag(y){const f=O.selected;if(f.length===0){const U=S.createDOMTagSelected(y);r.tagsSelected.appendChild(U),f.push(y),r.sectionSelected.setAttribute("data-display","1")}else if(!f.includes(y)){const U=S.createDOMTagSelected(y);r.tagsSelected.appendChild(U),f.push(y)}O.input="",r.tagsInput.value="",r.tagsSuggested.setAttribute("data-show","0")},addInputTag(){const y=O.input;if(y.length===0)return;S.addTag(y)},createSuggested(y){F(y,O,r)},completeEdit(){if(r.text.value.length===0)return;const y=l.editId;L.edit(y,r.changeDate.value==="1",r.text.value,r.color.value,O.selected),S.closeTodoModal()},openEdit(y){l.editId=y;const f=x.todos[y];S.initTagsEdit(f.tags),r.title.textContent=l.EDIT_TITLE,r.sectionDate.setAttribute("data-display","1"),r.changeDate.value="0",r.text.value=f.text,r.color.value=f.color,r.buttonComplete.textContent="edit",r.buttonComplete.onclick=S.completeEdit,S.openTodoModal()},completeCreate(){if(r.text.value.length===0)return;u(r.text.value,r.color.value,O.selected),S.closeTodoModal()},openCreate(){r.title.textContent=l.CREATE_TITLE,r.text.value="",r.color.value="default",r.sectionDate.setAttribute("data-display","0"),r.sectionSelected.setAttribute("data-display","0"),r.tagsSuggested.setAttribute("data-show","0"),r.buttonComplete.textContent="create",r.buttonComplete.onclick=S.completeCreate,S.resetTagsSelected(),S.openTodoModal()}};var e={input:"",charSuggested:"",suggested:[],tempSuggested:[]},T="general_filter",a={root:document.getElementById(T),buttonComplete:document.getElementById(T).button_complete,buttonClear:document.getElementById(T).button_clear,status:document.getElementById(T).status,color:document.getElementById(T).color,tagsInput:document.getElementById(T).tags_input,tagsSuggested:document.getElementById(T).tags_suggested,noTagsSuggested:document.getElementById(T).no_tags_suggested,sectionSelected:document.getElementById("general_filter-section-selected"),tagsSelected:document.getElementById(T).tags_selected,fragment:document.createDocumentFragment()},t={openModal(){const y=document.getElementById("modal_filter");if(y===null){console.warn("WARN: modal.filter does not exist");return}y.setAttribute("data-display","1"),document.body.style.overflow="hidden"},closeModal(){const y=document.getElementById("modal_filter");if(y===null){console.warn("WARN: modal.filter does not exist");return}y.setAttribute("data-display","0"),document.body.style.overflow=""},onMatchMedia(y){const f=a.root,U=document.getElementById("modal_filter");if(y.matches){if(U.getAttribute("data-display")==="1")U.setAttribute("data-display","0"),document.body.style.overflow="";document.getElementById("aside_filter").appendChild(f)}else U.firstElementChild?.appendChild(f)},addTag(y){if(A.addTag(y)){const U=R.createDOMButtonTag(y);a.tagsSelected.appendChild(U),a.sectionSelected?.setAttribute("data-display","1")}e.input="",a.tagsInput.value="",a.tagsSuggested.setAttribute("data-show","0")},removeTag(y){if(A.removeTag(y),E.tags.length===0)a.sectionSelected?.setAttribute("data-display","0")},createSuggested(y){F(y,e,a)}};var fy=window.matchMedia("(min-width: 780px)");if(fy.addEventListener("change",t.onMatchMedia),fy.matches)t.onMatchMedia(fy);{let y=function(){document.getElementById("modal_init")?.remove()},f=function(){localStorage.setItem("show-init","false"),document.getElementById("modal_init")?.remove()};const U=localStorage.getItem("show-init");if(U!=="false"){const k=document.getElementById("modal_init-button-close"),q=document.getElementById("modal_init-button-complete");if(k!==null&&q!==null)k.onclick=y,q.onclick=f;if(U===void 0)localStorage.setItem("show-init","true")}else document.getElementById("modal_init")?.remove()}{const y=localStorage.getItem("todo.ids");if(y!==null){if(y.length>2)try{x.ids=JSON.parse(localStorage["todo.ids"])}catch{const f=localStorage.getItem("theme");if(localStorage.clear(),localStorage.setItem("todo.ids","[]"),f!==null)localStorage.setItem("theme",f)}}else localStorage.setItem("todo.ids","[]")}{let y=-1;const f=x.ids.length;let U="";for(let k=0;k<f;k+=1){U=x.ids[k];const q=localStorage.getItem(`todo.${U}`);if(q!==null){let z;try{z=JSON.parse(q)}catch{if(localStorage.removeItem(`todo.${U}`),y===-1)y=k;continue}x.todos[U]=z;const G=I(U,z.text,z.date,z.tags,z.color,z.complete);if(G.setAttribute("data-display","1"),z.completed)L.setDOMTodoComplete(G,!0);if(H.todos[U]=G,H.fragment.appendChild(G),x.selected.push(U),y!==-1)x.ids[y]=x.ids[k],y+=1}else if(y===-1)y=k}if(Element.prototype.append.apply(H.root,H.fragment.children),y!==-1)x.ids.length=y}{let y="";for(let f=0;f<x.ids.length;f+=1){y=x.ids[f];const U=x.todos[y];R.add(U.tags)}}{let y=function(U){const k=U.currentTarget,q=k.getAttribute("data-value")==="dark"?"light":"dark";k.setAttribute("data-value",q),localStorage.setItem("theme",q),document.body.className=q};const f=document.getElementById("header_button-theme");if(f!==null){f.onclick=y;let U="light";const k=localStorage.getItem("theme");if(k!==null)U=k;else{if(window.matchMedia!==void 0&&window.matchMedia("(prefers-color-scheme: dark)").matches)U="dark";else U="light";localStorage.setItem("theme",U)}f.setAttribute("data-value",U),document.body.className=U}}{const y=document.getElementById("header_button-create");if(y===null)throw Error("header_button-create is null");else y.addEventListener("click",S.openCreate)}{let y=function(f){let U=f.getAttribute("data-id");while(U===null&&f!==H.root)f=f.parentElement,U=f.getAttribute("data-id");return U};H.root.addEventListener("click",function(f){const U=f.target;if(U===null)return;if(U.getAttribute("data-match")==="completed"||U.matches("[data-match=completed] *")){let k=y(U);if(k===null){console.warn("There is something wrong in buttom completed");return}L.toggleCompleted(k)}else if(U.getAttribute("data-match")==="edit"||U.matches("[data-match=edit] *")){let k=y(U);if(k===null){console.warn("There is something wrong in buttom edit");return}S.openEdit(k)}else if(U.getAttribute("data-match")==="remove"||U.matches("[data-match=remove] *")){let k=y(U);if(k===null){console.warn("There is something wrong in buttom remove");return}L.remove(k)}})}{let f=function(G){switch(G.key){case" ":G.preventDefault();break;case"Enter":S.addInputTag(),G.preventDefault()}};const y=document.getElementById("modal_todo-button-close");y.onclick=S.closeTodoModal;const U=r.tagsInput;U.oninput=function G(J){let K=J.currentTarget.value;S.createSuggested(K),O.input=K},U.onkeydown=f;const k=r.tagsAdd;k.onclick=S.addInputTag,k.onkeydown=f,r.tagsSuggested.addEventListener("pointerdown",function(G){const J=G.target;if(J.getAttribute("data-match")!==null){const K=J.getAttribute("data-value");if(K===null)return;S.addTag(K)}}),r.tagsSelected.addEventListener("click",function(G){const J=G.target;if(J.getAttribute("data-match")!==null){const K=J.getAttribute("data-value");if(K===null)return;J.remove(),S.removeTag(K)}})}{a.buttonComplete.onclick=A.completeAll,a.buttonClear.onclick=A.clearCompleted,document.getElementById("global_filter-status")?.addEventListener("click",function(z){const G=z.target;if(G.name==="status")A.changeStatus(G.value)}),document.getElementById("global_filter-colors")?.addEventListener("click",function(z){const G=z.target;if(G.name==="color")A.changeColor(G.value,G.checked)});const U=a.tagsInput;U.oninput=function z(G){const J=G.currentTarget.value;t.createSuggested(J),e.input=J},U.onkeydown=function z(G){if(G.key==="Enter"||G.key===" ")G.preventDefault()},a.tagsSuggested.addEventListener("pointerdown",function(z){const G=z.target;if(G.getAttribute("data-match")!==null){const J=G.getAttribute("data-value");if(J===null)return;t.addTag(J)}}),a.tagsSelected.addEventListener("click",function(z){const G=z.target;if(G.getAttribute("data-match")!==null){const J=G.getAttribute("data-value");if(J===null)return;G.remove(),t.removeTag(J)}})}{const y=document.getElementById("header_button-filter");y.onclick=t.openModal;const f=document.getElementById("modal_filter-button-close");f.onclick=t.closeModal}if(navigator.serviceWorker!==void 0)navigator.serviceWorker.register("serviceworker.js");
