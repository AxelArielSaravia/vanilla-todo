var E=window.matchMedia("(min-width: 780px)");var w=Intl.DateTimeFormat(void 0,{dateStyle:"short",timeStyle:"short"}),b={ids:[],todos:{},selected:[]},H={root:document.getElementById("main"),todos:{},fragment:document.createDocumentFragment()},f={colors:[],status:"all",tags:[]},_={counter:{},tags:[]},R={templateButtonTag:document.getElementById("template_button-tag"),templateTodotag:document.getElementById("template_todo-tag")},x={add(y,J,U){if(b.ids.push(y),b.todos[y]=J,H.todos[y]=U,localStorage.setItem(`todo.${y}`,JSON.stringify(J)),localStorage.setItem("todo.ids",JSON.stringify(b.ids)),J.tags.length>0)B.add(J.tags);if(f.status!=="completed"){if(f.colors.length>0&&!C.includeColor(J.color))return;if(f.tags.length>0&&(J.tags.length===0||!C.includeTags(J.tags)))return;b.selected.push(y),U.setAttribute("data-display","1")}H.root?.appendChild(U)},compareTodoTags(y,J){if(y.length===0&&J.length===0)return-1;else if(J.length===0)return-2;else if(y.length===0)return 0;const U=y.length<J.length?y.length:J.length;for(let k=0;k<U;k+=1)if(y[k]!==J[k])return k;if(y.length!==J.length)return U;return-1},edit(y,J,U,k,q){const z=b.todos[y];if(z===void 0)return;const G=H.todos[y];let K=!1;if(J){K=!0;const P=Date.now();z.date=P,G.header.firstElementChild.textContent=w.format(P);let Q=b.ids.indexOf(y),V=b.ids.length;if(Q===-1){console.error("TodosMethods.edit: There is no id in ids.","Something is break");return}if(b.ids.copyWithin(Q,Q+1,V),b.ids[V-1]=y,Q=b.selected.indexOf(y),Q!==-1)V=b.selected.length,b.selected.copyWithin(Q,Q+1,V),b.selected[V-1]=y;H.root.appendChild(G)}if(U!==z.text)K=!0,z.text=U,G.main.firstElementChild.textContent=U;if(k!==z.color)K=!0,z.color=k,G.setAttribute("data-color",k);if(q!==void 0){const P=x.compareTodoTags(z.tags,q);if(P===-2)K=!0,B.remove(z.tags),z.tags.length=0,G.footer.replaceChildren();else if(P!==-1){K=!0,B.add(q,P),B.remove(q,P);const Q=G.footer.children;let V;for(let X=P;X<q.length;X+=1)if(z.tags[X]=q[X],X<z.tags.length)Q[X].title="tag: "+q[X],Q.firstElementChild.textContent=q[X],H.fragment.appendChild(Q[X]);else V=B.createDOMTodoTag(q[X]),H.fragment.appendChild(V);if(q.length<z.tags.length)z.tags.length=q.length;Element.prototype.replaceChildren.apply(G.footer,H.fragment.children)}}if(K)localStorage.setItem(`todo.${y}`,JSON.stringify(z))},remove(y){const J=b.ids,U=J.indexOf(y);if(U===-1)return;if(U!==J.length-1)J.copyWithin(U,U+1,J.length);J.pop();const k=H.todos[y];B.remove(b.todos[y].tags),delete b.todos[y],delete H.todos[y],x.removeSelected(y),H.root.removeChild(k),localStorage.removeItem(`todo.${y}`),localStorage.setItem("todo.ids",JSON.stringify(b.ids))},removeSelected(y){const J=b.selected;let U=J.indexOf(y);if(U===-1)return!1;if(U!==J.length-1)J.copyWithin(U,U+1,J.length);J.pop();const k=H.todos[y];if(k!==void 0)k.setAttribute("data-display","0");return!0},toggleCompleted(y){const J=b.todos[y];if(J===void 0)return;J.completed=!J.completed,localStorage.setItem(`todo.${y}`,JSON.stringify(J));const U=H.todos[y];if(U===void 0)throw Error("DOMTodo is undefined when it must not be");if(x.setDOMTodoComplete(U,J.completed),J.completed&&f.status==="active"||!J.completed&&f.status==="completed")x.removeSelected(y)},setDOMTodoComplete(y,J){if(J)y.setAttribute("data-completed","1"),y.buttonToggle.title="mark as no completed";else y.setAttribute("data-completed","0"),y.buttonToggle.title="mark as completed"}},C={clearCompleted(){const y=b.ids;let J=-1;for(let U=0;U<y.length;U+=1){let k=y[U];const q=b.todos[k];if(q.completed){const z=H.todos[k];if(B.remove(q.tags),delete b.todos[k],delete H.todos[k],H.root.removeChild(z),localStorage.removeItem(`todo.${k}`),J===-1)J=U}else if(J!==-1)y[J]=y[U],J+=1}if(J===-1)return;switch(y.length=J,localStorage.setItem("todo.ids",JSON.stringify(y)),f.status){case"active":return;case"completed":{b.selected.length=0;return}default:{const U=b.selected;J=-1;for(let k=0;k<U.length;k+=1){const q=U[k];if(b.todos[q]===void 0){if(J===-1)J=k}else if(J!==-1)U[J]=U[k],J+=1}if(J!==-1)U.length=J}}},completeAll(){let y=!1;for(let J=0;J<b.ids.length;J+=1){let U=b.ids[J],k=b.todos[U];if(!k.completed){y=!0,k.completed=!0,localStorage.setItem(`todo.${U}`,JSON.stringify(k));let q=H.todos[U];if(f.status==="active")q.setAttribute("data-desplay","0");x.setDOMTodoComplete(q,!0)}}if(!y)return;switch(f.status){case"all":return;case"active":b.selected.length=0;break;default:C.selectTodos()}},changeColor(y,J){if(f.colors.length>0){const U=f.colors.indexOf(y);if(J){if(U!==-1)return;f.colors.push(y),C.selectTodos()}else{if(U===-1)return;if(f.colors[U]=f.colors[f.colors.length-1],f.colors.pop(),f.colors.length>0){let k=0;const q=b.selected;for(let z=0;z<q.length;z+=1){let G=q[z],K=b.todos[G];if(y!==K.color)q[k]=q[z],k+=1;else H.todos[G].setAttribute("data-display","0")}q.length=k}else C.selectTodos()}}else if(J){const U=b.selected;let k=0;for(let q=0;q<U.length;q+=1){let z=U[q],G=b.todos[z];if(y===G.color)U[k]=z,k+=1;else H.todos[z].setAttribute("data-display","0")}U.length=k,f.colors.push(y)}},changeStatus(y){if(y===f.status)return;f.status=y,C.selectTodos()},includeColor(y){let J;for(let U=0;U<f.colors.length;U+=1)if(J=f.colors[U],y===J)return!0;return!1},includeTags(y){let J=y.length;if(J<f.tags.length)return!1;let U="",k="";y:for(let q=0;q<f.tags.length;q+=1){k=f.tags[q];for(let z=0;z<J;z+=1)if(U=y[z],U===k){y[z]=y[J-1],y[J-1]=U,J-=1;continue y}return!1}return!0},selectTodos(){const{selected:y,ids:J}=b;if(f.status==="all")for(let q=0;q<J.length;q+=1)y[q]=J[q];else{const q=f.status==="completed";let z=0;for(let G=0;G<J.length;G+=1){let K=J[G];if(b.todos[K].completed===q)y[z]=K,z+=1;else H.todos[K].setAttribute("data-display","0")}if(z<y.length)y.length=z}const U=f.colors;if(U.length>0){let q=0;for(let z=0;z<y.length;z+=1){let G=y[z],K=b.todos[G];for(let Q=0;Q<U.length;Q+=1)if(K.color===U[Q]){y[q]=G,q+=1;break}H.todos[G].setAttribute("data-display","0")}y.length=q}const k=f.tags;if(k.length>0){let q=0,z=0;while(z<k.length&&y.length>0){const G=k[z];for(let K=0;K<y.length;K+=1){const P=y[K],Q=b.todos[P].tags;for(let X=0;X<Q.length;X+=1)if(Q[X]===G){y[q]=P,q+=1;break}H.todos[P].setAttribute("data-display","0")}y.length=q,z+=1}}for(let q=0;q<y.length;q+=1){let z=y[q];H.todos[z].setAttribute("data-display","1")}}},B={createDOMButtonTag(y){const J=R.templateButtonTag.content.cloneNode(!0).firstElementChild;return J.title=`tag: ${y}`,J.name=y,J.setAttribute("data-value",y),J.firstElementChild.textContent=y,J},createDOMTodoTag(y){const J=R.templateTodotag.content.cloneNode(!0).firstElementChild;return J.title="tag: "+y,J.firstElementChild.textContent=y,J},add(y,J){if(J===void 0)J=0;let U="";while(J<y.length){if(U=y[J],_.counter[U]!==void 0)_.counter[U]+=1;else _.counter[U]=1;J+=1}},remove(y,J){if(J===void 0)J=0;let U="";while(J<y.length){if(U=y[J],_.counter[U]!==void 0){if(_.counter[U]-=1,_.counter[U]===0)delete _.counter[U]}J+=1}}};var u=function(){const y=document.getElementById("modal_todo");return{root:y,title:document.getElementById("modal_todo-title"),text:y.text,sectionDate:document.getElementById("modal_todo-section-date"),changeDate:y.change_date,color:y.color,tagsInput:y.tags_input,tagsAdd:y.tags_add,tagsSugested:y.tags_suggested,tagsSelected:y.tags_selected,buttonComplete:y.button_complete,fragment:document.createDocumentFragment()}}(),I={CREATE:"create",CREATE_TITLE:"New Todo",EDIT:"edit",EDIT_TITLE:"Edit Todo",editId:"",tagsSelected:[],selectedChange:!1,tagsSuggested:[]},j={createDOMTagSelected(y){const J=B.createDOMButtonTag(y);return J.addEventListener("click",j.removeTagSelected),J},createDOMTagSuggested(y){const J=B.createDOMButtonTag(y);return J.onclick=null,J},closeTodoModal(){u.root.setAttribute("data-display","0"),document.body.style.overflow=""},initTagsEdit(y){if(I.tagsSuggested.length=0,u.tagsSugested.replaceChildren(),y.length>0){const J=I.tagsSelected,U=u.tagsSelected.children;for(let k=0;k<y.length;k+=1)if(J[k]=y[k],k<J.length){U[k].name=y[k],U[k].setAttribute("data-value",y[k]);let q=U[k].firstElementChild;if(q!==null)q.textContent=y[k];u.fragment.appendChild(U[k])}else{const q=j.createDOMTagSelected(y[k]);u.fragment.appendChild(q)}if(y.length<J.length)J.length=y.length;Element.prototype.replaceChildren.apply(u.tagsSelected,u.fragment.children)}},openTodoModal(){u.root.setAttribute("data-display","1"),document.body.style.overflow="hidden"},removeTagSelected(y){const J=y.currentTarget.getAttribute("data-value");if(y.currentTarget.remove(),J!==null){let U=I.tagsSelected.indexOf(J);if(U!==-1)I.tagsSelected.copyWithin(U,U+1,I.tagsSelected.length),I.tagsSelected.pop()}},resetTags(){I.tagsSelected.length=0,I.tagsSuggested.length=0,u.tagsSelected.replaceChildren(),u.tagsSugested.replaceChildren()}};{const y=document.getElementById("modal_todo-button-close");y.onclick=j.closeTodoModal}var r=function(){let y=Date.now().toString();for(let J=0;J<8;J+=1){const U=F[Math.floor(Math.random()*F.length)],k=Math.floor(Math.random()*y.length);if(k===y.length)y=String.prototype.concat.call(y,U);else if(k===0)y=String.prototype.concat.call(U,y);else y=String.prototype.concat.call(String.prototype.slice.call(y,0,k),U,String.prototype.slice.call(y,k))}return y},D=function(y){const U=y.currentTarget.getAttribute("data-id");if(U===null){console.warn("WARNNING: data-id does not exist in this button.","We can not toggle the completition of the todo.");return}x.toggleCompleted(U)},g=function(y){const J=y.currentTarget.getAttribute("data-id");if(J===null){console.warn("WARNNING: data-id does not exist in this button.","We can not remove the todo.");return}x.remove(J)},S=function(y){if(u.text.value.length===0)return;const J=I.editId;x.edit(J,u.changeDate.value==="1",u.text.value,u.color.value,I.selectedChange?I.tagsSelected:void 0),j.closeTodoModal()},l=function(y){const J=y.currentTarget.getAttribute("data-id");if(J===null)return;I.editId=J;const U=b.todos[J];j.initTagsEdit(U.tags),u.title.textContent=I.EDIT_TITLE,u.sectionDate.setAttribute("data-display","1"),u.changeDate.value="0",u.text.value=U.text,u.color.value=U.color,u.buttonComplete.textContent="edit",u.buttonComplete.onclick=S,j.openTodoModal()},M=function(y,J,U,k,q="default",z=!1){const K=O.content.cloneNode(!0).firstElementChild;if(K.id=y,K.setAttribute("data-color",q),z)K.setAttribute("data-completed","1");const{firstElementChild:P,lastElementChild:Q}=K,V=P.children[0],X=P.children[1],Y=P.children[2],Z=V.children[0],$=V.children[1],v=V.children[2];if(Z.textContent=w.format(U),$.setAttribute("data-id",y),v.setAttribute("data-id",y),$.onclick=l,v.onclick=g,X.firstElementChild.textContent=J,K.header=V,K.main=X,K.footer=Y,k.length>0)for(let W=0;W<k.length;W+=1){const N=B.createDOMTodoTag(k[W]);Y.appendChild(N)}const L=Q.firstElementChild;return L.setAttribute("data-id",y),L.onclick=D,K.buttonToggle=L,K},T=function(y,J,U){const k=r(),q=Date.now(),z={color:J,completed:!1,date:q,id:k,tags:Array.from(U),text:y},G=M(k,y,q,U,J);x.add(k,z,G)},O=document.getElementById("template_todo"),F="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_";{let y=function(){document.getElementById("modal_init")?.remove()},J=function(){localStorage.setItem("show-init","false"),document.getElementById("modal_init")?.remove()};s=y,a=J;const U=localStorage.getItem("show-init");if(U!=="false"){const k=document.getElementById("modal_init-button-close"),q=document.getElementById("modal_init-button-complete");if(k!==null&&q!==null)k.onclick=y,q.onclick=J;if(U===void 0)localStorage.setItem("show-init","true")}else document.getElementById("modal_init")?.remove()}var s,a;var e={root:document.getElementById("general_filter"),buttonComplete:document.getElementById("general_filter").button_complete,buttonClear:document.getElementById("general_filter").button_clear,status:document.getElementById("general_filter").status,color:document.getElementById("general_filter").color,tagsInput:document.getElementById("general_filter").tags_input,tagsSuggested:document.getElementById("general_filter").tags_suggested,tagsSelected:document.getElementById("general_filter").tags_selected},d={openModal(){const y=document.getElementById("modal_filter");if(y===null){console.warn("WARN: modal.filter does not exist");return}y.setAttribute("data-display","1"),document.body.style.overflow="hidden"},closeModal(){const y=document.getElementById("modal_filter");if(y===null){console.warn("WARN: modal.filter does not exist");return}y.setAttribute("data-display","0"),document.body.style.overflow=""},onMatchMedia(y){const J=e.root,U=document.getElementById("modal_filter");if(y.matches){if(U.getAttribute("data-display")==="1")U.setAttribute("data-display","0"),document.body.style.overflow="";document.getElementById("aside_filter").appendChild(J)}else U.firstElementChild?.appendChild(J)},changeStatus(y){C.changeStatus(y.currentTarget.value)},changeColor(y){const J=y.currentTarget;C.changeColor(J.value,J.checked)}};{e.buttonComplete.onclick=C.completeAll,e.buttonClear.onclick=C.clearCompleted;const y=e.status;for(let U=0;U<y.length;U+=1){const k=y[U];k.onclick=d.changeStatus}const J=e.color;for(let U=0;U<J.length;U+=1){const k=J[U];k.onclick=d.changeColor}}if(E.addEventListener("change",d.onMatchMedia),E.matches)d.onMatchMedia(E);{const y=document.getElementById("header_button-filter");y.onclick=d.openModal;const J=document.getElementById("modal_filter-button-close");J.onclick=d.closeModal}{let y=function(U){const k=U.currentTarget,q=k.getAttribute("data-value")==="dark"?"light":"dark";k.setAttribute("data-value",q),localStorage.setItem("theme",q),document.body.className=q};const J=document.getElementById("header_button-theme");if(J!==null){J.onclick=y;let U="light";const k=localStorage.getItem("theme");if(k!==null)U=k;else{if(window.matchMedia!==void 0&&window.matchMedia("(prefers-color-scheme: dark)").matches)U="dark";else U="light";localStorage.setItem("theme",U)}J.setAttribute("data-value",U),document.body.className=U}}var Uy=function(){if(u.text.value.length===0)return;T(u.text.value,u.color.value,I.tagsSelected),j.closeTodoModal()},ky=function(){j.resetTags(),u.title.textContent=I.CREATE_TITLE,u.text.value="",u.color.value="default",u.sectionDate.setAttribute("data-display","0"),u.buttonComplete.textContent="create",u.buttonComplete.onclick=Uy,j.openTodoModal()};{const y=document.getElementById("header_button-add");if(y===null)throw Error("header_button-add is null");else y.addEventListener("click",ky)}{const y=localStorage.getItem("todo.ids");if(y!==null){if(y.length>2)try{b.ids=JSON.parse(localStorage["todo.ids"])}catch{const J=localStorage.getItem("theme");if(localStorage.clear(),localStorage.setItem("todo.ids","[]"),J!==null)localStorage.setItem("theme",J)}}else localStorage.setItem("todo.ids","[]")}{let y=-1;const J=b.ids.length;let U="";for(let k=0;k<J;k+=1){U=b.ids[k];const q=localStorage.getItem(`todo.${U}`);if(q!==null){let z;try{z=JSON.parse(q)}catch{if(localStorage.removeItem(`todo.${U}`),y===-1)y=k;continue}b.todos[U]=z;const G=M(U,z.text,z.date,z.tags,z.color,z.complete);if(G.setAttribute("data-display","1"),z.completed)x.setDOMTodoComplete(G,!0);if(H.todos[U]=G,H.fragment.appendChild(G),b.selected.push(U),y!==-1)b.ids[y]=b.ids[k],y+=1}else if(y===-1)y=k}if(Element.prototype.append.apply(H.root,H.fragment.children),y!==-1)b.ids.length=y}{let y="";for(let J=0;J<b.ids.length;J+=1){y=b.ids[J];const U=b.todos[y];B.add(U.tags)}}if(navigator.serviceWorker!==void 0)navigator.serviceWorker.register("serviceworker.js");
